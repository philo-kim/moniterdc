# 세계관 발견 과정 상세 가이드

**파일**: `engines/analyzers/worldview_evolution_engine.py`
**핵심 함수**: `_consolidate_worldviews()`

---

## 🔍 전체 흐름

```
┌──────────────────────────────────────────┐
│ 1. 입력 데이터 준비                      │
│    458개 perception → 200개 샘플링      │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│ 2. 요약 데이터 생성                      │
│    각 perception의 핵심 구조 추출        │
│    - mechanisms                          │
│    - actor (subject, purpose)            │
│    - logic_chain                         │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│ 3. GPT-5 프롬프트 구성                   │
│    200개 요약 → JSON 형태로 전달         │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│ 4. GPT-5 클러스터링                      │
│    "5-10개 핵심 세계관 추출하라"         │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│ 5. 세계관 JSON 반환                      │
│    - title                               │
│    - actor                               │
│    - core_mechanisms                     │
│    - logic_pattern                       │
└──────────────────────────────────────────┘
```

---

## 📥 1단계: 입력 데이터 준비

### 코드 (104-111줄)
```python
summary_data = []
for p in perceptions[:200]:  # 최근 200개만 (토큰 제약)
    summary_data.append({
        'mechanisms': p.get('mechanisms', []),
        'actor': p.get('actor', {}).get('subject', ''),
        'purpose': p.get('actor', {}).get('purpose', ''),
        'pattern': p.get('consistency_pattern', ''),
        'logic_chain': p.get('logic_chain', [])[:3]  # 처음 3단계만
    })
```

### 실제 데이터 예시
```json
[
  {
    "mechanisms": ["즉시_단정", "역사_투사"],
    "actor": "민주당/좌파",
    "purpose": "권력 유지",
    "pattern": "정보_파악_불법_해석",
    "logic_chain": [
      "민주당이 정보를 파악했다",
      "합법 취득 가능성을 배제했다",
      "불법 사찰로 단정했다"
    ]
  },
  {
    "mechanisms": ["즉시_단정", "필연적_인과"],
    "actor": "중국 범죄조직",
    "purpose": "한국 내 범죄 활동",
    "pattern": "관찰_즉시_위협",
    "logic_chain": [
      "맘카페 실종 글 관찰",
      "중국 범죄조직 연결",
      "장기밀매 위협 제기"
    ]
  },
  ... (200개)
]
```

---

## 🤖 2단계: GPT-5 프롬프트

### 전체 프롬프트 (113-160줄)

```
다음은 DC Gallery 정치 글 200개의 추론 구조 분석 결과입니다.

[200개 요약 데이터 JSON]

이 데이터를 분석해서 **5-10개의 핵심 세계관**을 추출해주세요.

**요구사항:**

1. 각 세계관은 **추론 메커니즘 기반**이어야 합니다 (주제가 아님)
   - 좋은 예: "민주당의 어떤 행동도 독재 시도로 해석하는 구조"
   - 나쁜 예: "민주당에 대한 인식" (이건 주제임)

2. 각 세계관은 **다양한 사건에 적용 가능**해야 합니다
   - 유심교체, 집회제한, 법안발의 등 전혀 다른 사건에도 같은 논리 적용

3. 행위자 중심으로 분류:
   - 민주당/좌파에 대한 해석
   - 중국에 대한 해석
   - 언론/사법부에 대한 해석
   - 보수 진영 자신들에 대한 해석

4. 각 세계관마다:
   - 핵심 메커니즘 (즉시_단정, 필연적_인과 등)
   - 행위자
   - 추정 목적
   - 논리 구조 (A → B → C)

JSON 형식:
{
  "worldviews": [
    {
      "title": "민주당/좌파의 정보 파악 → 즉시 불법/사찰로 해석",
      "actor": "민주당/좌파",
      "core_mechanisms": ["즉시_단정", "역사_투사"],
      "logic_pattern": {
        "trigger": "민주당이 어떤 정보를 알고 있음",
        "skipped_verification": ["정보 출처 확인", "합법 가능성"],
        "conclusion": "불법 사찰 및 독재 시도"
      },
      "examples": ["유심교체 정보", "집회 정보"],
      "estimated_coverage_pct": 15
    }
  ]
}

**중요:** 통합 시 특정성을 잃지 마세요. 각 세계관은 구체적인 논리 패턴을 가져야 합니다.
```

---

## 🎯 프롬프트 핵심 전략

### 1. "메커니즘 기반" 강조

**❌ 나쁜 세계관 (주제 중심)**:
```
"민주당에 대한 인식"
"중국에 대한 태도"
```
→ 너무 포괄적, 구체적 논리 없음

**✅ 좋은 세계관 (메커니즘 기반)**:
```
"민주당의 정보 파악 → 즉시 불법 사찰로 해석"
"중국의 어떤 행동도 → 조직적 위협으로 연결"
```
→ 구체적 논리 구조 명시

### 2. "다양한 사건 적용 가능" 요구

**목적**: 과적합(overfitting) 방지

**예시**:
- 유심교체 정보 파악 → 불법 사찰
- 집회 정보 파악 → 불법 사찰
- 통신영장 발부 → 불법 사찰

**→ 같은 패턴**: "정보 파악 → 검증 생략 → 불법으로 단정"

### 3. "행위자 중심" 분류

**이유**: 세계관은 "누구에 대한 해석"인지가 중요

**분류**:
1. 민주당/좌파 → 독재/사찰 시도
2. 중국 → 조직적 위협
3. 언론/사법 → 좌파 장악
4. 보수 자신 → 애국/정당방위

### 4. 논리 구조 명시

**logic_pattern 구조**:
```json
{
  "trigger": "무엇이 관찰되면",
  "skipped_verification": ["어떤 검증을 생략하고"],
  "conclusion": "어떤 결론에 도달하는가"
}
```

**실제 예시**:
```json
{
  "trigger": "민주당이 개인정보를 알고 있음",
  "skipped_verification": [
    "합법적 취득 가능성 (제보, 공개정보)",
    "영장/절차 존재 여부",
    "개별 기관의 자율 판단"
  ],
  "conclusion": "불법 사찰·통신사 협박·사법부 장악 등 조직적 독재"
}
```

---

## 📤 3단계: GPT-5 응답

### 실제 응답 예시

```json
{
  "worldviews": [
    {
      "title": "민주당/좌파의 정보 파악 → 즉시 불법 사찰·장악으로 해석",
      "actor": "민주당/좌파",
      "core_mechanisms": ["즉시_단정", "역사_투사", "네트워크_추론"],
      "logic_pattern": {
        "trigger": "민주당/좌파가 개인·집회·통신 관련 정보를 알고 있거나 선제적으로 대응",
        "skipped_verification": [
          "합법적 취득 가능성(제보·공개정보)",
          "영장·절차 존재 여부",
          "개별 기관의 자율 판단"
        ],
        "conclusion": "불법 사찰·통신사 협박·사법부 장악 등 조직적 독재 시도"
      },
      "examples": [
        "지귀연 유심/핸드폰 교체 정보 사전 인지",
        "보수 인사 대상 통신영장 문자 수신 정황",
        "집회 정보·동선 파악"
      ],
      "estimated_coverage_pct": 16
    },
    {
      "title": "중국의 국경/제도 완화 → 필연적 범죄 유입·치안 위협",
      "actor": "중국/중국인",
      "core_mechanisms": ["필연적_인과", "역사_투사", "즉시_단정"],
      "logic_pattern": {
        "trigger": "중국 관련 제도 완화(무비자, 교류 등) 또는 중국인 관련 사건",
        "skipped_verification": [
          "통계적 검증",
          "인과관계 입증",
          "개별 사례의 대표성"
        ],
        "conclusion": "조직적 범죄(장기밀매 등) 유입·확산 필연적"
      },
      "examples": [
        "무비자 입국 → 범죄조직 잠입",
        "맘카페 실종 글 → 장기밀매 연결",
        "중국 자동차 → 보조금 사기"
      ],
      "estimated_coverage_pct": 12
    },
    ... (5-10개)
  ]
}
```

---

## 🔄 4단계: 변화 감지

### 기존 세계관과 비교

**파일**: `worldview_evolution_engine.py` (192-280줄)

```python
async def _detect_changes(self, existing, new):
    # GPT-5로 비교
    comparison_prompt = f"""
    기존 세계관 ({len(existing)}개):
    {기존 제목들}

    새 세계관 ({len(new)}개):
    {새 제목들}

    변화 분석:
    1. 새로 등장한 세계관
    2. 사라진 세계관
    3. 변화한 세계관
    4. 유지된 세계관
    """
```

### 변화 유형

1. **신규 (new)**: 기존에 없던 패턴 등장
2. **소멸 (disappeared)**: 더 이상 나타나지 않음
3. **진화 (evolved)**: 비슷하지만 구체화/변형
4. **유지 (stable)**: 안정적 지속

---

## 💾 5단계: DB 저장

### worldviews 테이블 구조

```sql
INSERT INTO worldviews (
  title,
  frame,  -- JSON 필드
  core_subject,
  core_attributes,
  description
) VALUES (
  '민주당/좌파의 정보 파악 → 즉시 불법 사찰로 해석',
  '{
    "actor": "민주당/좌파",
    "core_mechanisms": ["즉시_단정", "역사_투사"],
    "logic_pattern": {...},
    "examples": [...]
  }',
  '민주당/좌파',
  ['즉시_단정', '역사_투사'],
  '불법 사찰·통신사 협박·사법부 장악 등 조직적 독재 시도'
);
```

---

## 🎓 핵심 원리

### 왜 "메커니즘 기반"인가?

**주제 기반 분류의 문제**:
```
"민주당에 대한 인식"
→ 너무 포괄적
→ 구체적 논리 없음
→ 예측력 없음
```

**메커니즘 기반의 장점**:
```
"민주당의 정보 파악 → 검증 생략 → 불법 사찰로 단정"
→ 구체적 논리 구조
→ 새로운 사건에도 적용 가능
→ 예측력 있음
```

**예시**:
- 사건 A: 유심교체 → 불법 사찰
- 사건 B: 집회 정보 → 불법 사찰
- 사건 C: 법안 발의 → ???
  → 메커니즘으로 예측 가능!

### 왜 "5-10개"인가?

**너무 적으면 (2-3개)**:
```
- 지나친 일반화
- 세부 패턴 손실
- 커버리지 낮음
```

**너무 많으면 (20-30개)**:
```
- 과적합 (overfitting)
- 관리 어려움
- 중복 패턴
```

**적절한 개수 (5-10개)**:
```
- 구체성 유지
- 관리 가능
- 높은 커버리지 (60-70%)
```

---

## 🔬 V5+ 데이터의 영향

### Before (기존 프롬프트)
```
입력: 200개 × 6.4 = 1,280개 문장
- "보라고 권유" ← 노이즈
- "맘카페에 글 많다" ← 노이즈
- "장기밀매 가능성" ← 핵심 (40%)

GPT-5가 봤을 때:
"뭔 소린지 모르겠고, 일단 비슷한 단어끼리 묶어볼까?"
→ 모호한 경계
→ 중복 세계관
→ 낮은 품질
```

### After (V5+ 프롬프트)
```
입력: 200개 × 2.2 = 440개 문장
- "중국 범죄조직이 무비자로 잠입" ← 핵심 (100%)
- "무비자 입국이 범죄 활동 관련" ← 핵심 (100%)

GPT-5가 봤을 때:
"아, 명확한 패턴들이 보이네!"
→ 뚜렷한 경계
→ 중복 없음
→ 높은 품질
```

---

## 🎯 예상 결과 (V5+ 적용 후)

### 기존 (V5+ 이전)
```
세계관 7개:
1. 민주당 사찰 (모호)
2. 중국 위협 (모호)
3. 보수 정당화 (모호)
4-7. (중복/불명확)

커버리지: 63%
품질: 중하
```

### 개선 (V5+ 이후)
```
세계관 5-6개:
1. 민주당 정보파악 → 불법사찰 (명확)
2. 중국 제도완화 → 범죄유입 (명확)
3. 경찰/사법 → 좌편향 (명확)
4. 보수행동 → 애국방위 (명확)
5. 언론/제도 → 좌파장악 (명확)

커버리지: 70-75%
품질: 상
```

---

## 📝 실행 명령

```bash
PYTHONPATH=/Users/taehyeonkim/dev/minjoo/moniterdc python3 scripts/run_worldview_evolution.py
```

**출력**:
```
================================================================================
세계관 진화 사이클 시작
================================================================================

✅ 최근 200개 perception 로드
🤖 GPT-5로 세계관 클러스터링 중...
  1. 민주당/좌파의 정보 파악 → 즉시 불법 사찰로 해석
     행위자: 민주당/좌파, 메커니즘: 즉시_단정, 역사_투사
  2. 중국의 국경 완화 → 필연적 범죄 유입
     행위자: 중국, 메커니즘: 필연적_인과, 역사_투사
  ...

✅ 5개 세계관 추출
✅ 변화 감지 완료
✅ 변화 적용 완료
```

---

**핵심**: V5+ 깨끗한 데이터 → GPT-5가 명확한 패턴 인식 → 고품질 세계관 발견!
