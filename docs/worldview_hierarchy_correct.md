# 세계관 계층 구조 (올바른 버전)

**핵심 이해**: 현재 V1+ 결과가 **상위 세계관**이 되어야 함

---

## 올바른 계층 구조

### 상위 세계관 (Parent) = 현재 V1+ 결과

```
1. 민주당은 불법 사찰로 국민을 감시한다
2. 정부는 사법을 정치보복에 악용한다
3. 중국은 매크로로 여론을 조작한다
4. 언론은 특정 사건을 왜곡하여 보도한다
5. 보수는 국제 연대로 좌파에 맞선다
```

→ 이것들은 그대로 유지 (그들의 언어, 단정적 진술)

### 하위 세계관 (Child) = 구체적 사례

**상위 1**: "민주당은 불법 사찰로 국민을 감시한다"
```
├─ 하위 1-1: "민주당은 통신사를 협박해 유심 정보를 빼낸다"
│   - 사건: 지귀연 유심교체 정보 파악
│   - 방법: 통신사 협박
│   - 대상: 개인 통신 정보
│
├─ 하위 1-2: "민주당은 국정원을 동원해 국민을 사찰한다"
│   - 사건: 국정원 개편 시도
│   - 방법: 정보기관 장악
│   - 대상: 정치적 반대자
│
└─ 하위 1-3: "민주당은 경찰을 이용해 집회 참가자를 추적한다"
    - 사건: 자유대학 집회 제한
    - 방법: 경찰력 동원
    - 대상: 우파 집회 참가자
```

---

**상위 2**: "정부는 사법을 정치보복에 악용한다"
```
├─ 하위 2-1: "윤석열은 계엄으로 국회를 장악하려 했다"
│   - 사건: 12.3 계엄 선포
│   - 방법: 군 동원, 국회 진입 시도
│   - 목적: 국회 무력화
│
├─ 하위 2-2: "정부는 이진숙을 정치보복으로 체포했다"
│   - 사건: 이진숙 체포
│   - 방법: 검찰 동원
│   - 목적: 야당 인사 제거
│
├─ 하위 2-3: "법무부장관은 페이스북으로 우파를 모욕한다"
│   - 사건: 법무부장관 SNS 게시물
│   - 방법: 공개적 모욕
│   - 목적: 반대 세력 억압
│
└─ 하위 2-4: "검찰은 좌파 편향으로 우파만 기소한다"
    - 사건: 선택적 기소
    - 방법: 좌파 면죄, 우파 타깃
    - 목적: 정치적 불균형
```

---

**상위 3**: "중국은 매크로로 여론을 조작한다"
```
├─ 하위 3-1: "중국 댓글부대가 DC를 점령하고 있다"
│   - 현상: 반복적 고닉 패턴
│   - 장소: DC 갤러리
│   - 방법: 매크로 계정
│
├─ 하위 3-2: "중국 조선족이 장기밀매로 한국인을 죽인다"
│   - 현상: 맘카페 실종글 증가
│   - 주체: 조선족 범죄 조직
│   - 목적: 장기 적출
│
├─ 하위 3-3: "중국 기업이 쿠팡으로 한국 시장을 독점한다"
│   - 현상: SF Express 물류 증가
│   - 방법: 쿠팡 인수/협력
│   - 결과: 시장 왜곡
│
└─ 하위 3-4: "중국이 한국 정치에 직접 개입한다"
    - 현상: 중국 정부 발언
    - 대상: 한국 내정
    - 목적: 영향력 확대
```

---

**상위 4**: "언론은 특정 사건을 왜곡하여 보도한다"
```
├─ 하위 4-1: "언론은 자유대학 집회 규모를 축소해 보도한다"
│   - 사건: 자유대학 대규모 집회
│   - 왜곡: 참가 인원 축소
│   - 목적: 보수 세력 폄하
│
├─ 하위 4-2: "언론은 이재명 출연을 특혜로 편성한다"
│   - 사건: 이재명 방송 출연
│   - 왜곡: 야당 편향 편성
│   - 목적: 좌파 유리한 여론
│
└─ 하위 4-3: "포털은 우파 뉴스를 검열해 숨긴다"
    - 현상: 특정 뉴스 노출 차단
    - 대상: 보수 매체
    - 목적: 좌파 카르텔 유지
```

---

**상위 5**: "보수는 국제 연대로 좌파에 맞선다"
```
├─ 하위 5-1: "미국 보수와 연대해 좌파 헤게모니를 깬다"
│   - 사건: 찰리 커크 지지 확산
│   - 방법: 국제 보수 네트워크
│   - 목적: 좌파 대항
│
├─ 하위 5-2: "트럼프가 돌아오면 한국 좌파는 끝난다"
│   - 기대: 트럼프 재선
│   - 영향: 한국 좌파 붕괴
│   - 근거: 미국 보수 우위
│
└─ 하위 5-3: "자유대학 집회가 증명하는 것은 민심이다"
    - 사건: 대규모 보수 집회
    - 의미: 진짜 민심 대표
    - 정당성: 보수 대세론
```

---

## 핵심 차이

### 잘못된 이해 (제 이전 제안)
```
❌ 상위: "좌파/민주당의 권력 강화 시도"
   → 분석자 언어, 추상적 카테고리

✅ 상위: "민주당은 불법 사찰로 국민을 감시한다"
   → 그들의 언어, 구체적 믿음
```

### 올바른 구조
```
상위 (Parent): 그들의 믿음, 포괄적
  예: "민주당은 불법 사찰로 국민을 감시한다"
  → 여전히 그들의 언어
  → 하지만 여러 사례를 포괄

하위 (Child): 그들의 믿음, 매우 구체적
  예: "민주당은 통신사를 협박해 유심 정보를 빼낸다"
  → 특정 사건
  → 특정 방법
  → 특정 대상
```

---

## 구현 전략

### 1단계: 상위 세계관 생성 (현재 V1+ 그대로)

```
PROMPT: V1+ 프롬프트 사용
결과: 5-10개 상위 세계관
예시:
  - 민주당은 불법 사찰로 국민을 감시한다
  - 정부는 사법을 정치보복에 악용한다
  - 중국은 매크로로 여론을 조작한다
```

### 2단계: 각 상위에 대해 하위 세계관 생성

```python
prompt = f"""
상위 세계관: "{parent_title}"

이 상위 세계관에 속하는 구체적 사례 3-5개를 하위 세계관으로 생성하세요.

**하위 세계관 요구사항**:

1. **구체적 사건/대상 명시**:
   - ✅ "민주당은 통신사를 협박해 유심 정보를 빼낸다"
   - ❌ "민주당은 정보를 수집한다" (너무 일반적)

2. **그들의 언어 유지**:
   - 상위처럼 단정적 사실 진술
   - 메타 언어 없음

3. **구조**: [주어] + [구체적 방법/대상] + [구체적 행위]
   - "민주당은 통신사를 협박해 유심 정보를 빼낸다"
   - "윤석열은 계엄으로 국회를 장악하려 했다"
   - "중국 조선족이 장기밀매로 한국인을 죽인다"

4. **차별화**: 각 하위는 다른 구체적 사례

현재 데이터:
{perceptions_for_this_parent}

JSON 형식:
{{
  "child_worldviews": [
    {{
      "title": "민주당은 통신사를 협박해 유심 정보를 빼낸다",
      "specific_case": "지귀연 유심교체 정보 파악",
      "method": "통신사 협박",
      "target": "개인 통신 정보",
      "examples": ["유심교체", "개인정보 사전 파악"]
    }}
  ]
}}
"""
```

### 3단계: DB 스키마

```sql
-- 기존 worldviews 테이블에 필드 추가
ALTER TABLE worldviews
  ADD COLUMN parent_worldview_id UUID REFERENCES worldviews(id),
  ADD COLUMN level INTEGER DEFAULT 1, -- 1: parent, 2: child
  ADD COLUMN specific_case TEXT,      -- 구체적 사건 (child만)
  ADD COLUMN method TEXT,              -- 구체적 방법 (child만)
  ADD COLUMN target TEXT;              -- 구체적 대상 (child만)

-- Parent worldview 예시
INSERT INTO worldviews (title, level, parent_worldview_id) VALUES
  ('민주당은 불법 사찰로 국민을 감시한다', 1, NULL);

-- Child worldviews 예시
INSERT INTO worldviews (title, level, parent_worldview_id, specific_case, method, target) VALUES
  ('민주당은 통신사를 협박해 유심 정보를 빼낸다', 2, parent_id, '지귀연 유심교체', '통신사 협박', '개인 통신정보'),
  ('민주당은 국정원을 동원해 국민을 사찰한다', 2, parent_id, '국정원 개편', '정보기관 장악', '정치적 반대자');
```

### 4단계: Perception 매칭

```python
# Child worldview에 매칭
perception_worldview_links.child_worldview_id = child_id

# Parent는 child 합산
parent.total_perceptions = sum(child.total_perceptions for child in children)
```

---

## UI 표시

### 메인 페이지
```
세계관 목록 (Parent만)

1. 민주당은 불법 사찰로 국민을 감시한다 (45개 perception)
   [펼치기 ▼]

2. 정부는 사법을 정치보복에 악용한다 (68개 perception)
   [펼치기 ▼]

3. 중국은 매크로로 여론을 조작한다 (32개 perception)
   [펼치기 ▼]
```

### 펼쳤을 때
```
1. 민주당은 불법 사찰로 국민을 감시한다 (45개)
   [펼치기 ▲]

   세부 사례:
   1-1. 민주당은 통신사를 협박해 유심 정보를 빼낸다 (12개)
   1-2. 민주당은 국정원을 동원해 국민을 사찰한다 (18개)
   1-3. 민주당은 경찰로 집회 참가자를 추적한다 (15개)
```

### Perception 상세 페이지
```
이 인식이 속한 세계관:

📁 민주당은 불법 사찰로 국민을 감시한다
  └─ 📄 민주당은 통신사를 협박해 유심 정보를 빼낸다
      구체적 사건: 지귀연 유심교체 정보 파악
      방법: 통신사 협박
      대상: 개인 통신 정보
```

---

## 기대 효과

### Before (현재)
```
세계관: 민주당은 불법 사찰로 국민을 감시한다 (45개)
  → 유심교체, 국정원, 집회추적 등이 모두 섞임
  → 구체적 차이 파악 불가
```

### After (계층 구조)
```
상위: 민주당은 불법 사찰로 국민을 감시한다 (45개)
  ├─ 하위: 통신사 협박 → 유심 정보 (12개)
  ├─ 하위: 국정원 동원 → 국민 사찰 (18개)
  └─ 하위: 경찰 이용 → 집회 추적 (15개)

  → 각 사례의 구체적 맥락 보존
  → 시간에 따른 담론 변화 추적
  → perception과 정확한 매칭
```

---

## 다음 단계

1. **DB 스키마 마이그레이션 작성**
2. **하위 세계관 생성 프롬프트 테스트**
3. **worldview_evolution_engine.py 수정** (2단계 생성)
4. **mechanism_matcher.py 수정** (child에 매칭)
5. **Dashboard UI 수정** (계층 표시)

---

**핵심**:
- 상위 = 현재 V1+ 결과 (그들의 언어, 포괄적)
- 하위 = 구체적 사례 (그들의 언어, 매우 구체적)
- 둘 다 그들의 언어 유지!
